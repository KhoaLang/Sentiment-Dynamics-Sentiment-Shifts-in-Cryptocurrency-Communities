# Spark Configuration

spark:
  app:
    name: "sentiment-streaming"
    master: "local[*]"

  # Spark SQL Configuration
  sql:
    extensions: "org.apache.iceberg.spark.extensions.IcebergSparkSessionExtensions"
    catalog:
      iceberg:
        type: "rest"
        uri: "http://localhost:8181"
        warehouse: "s3://sentiment-data/warehouse"
        io-impl: "org.apache.iceberg.io.s3.S3FileIO"
        s3.endpoint: "http://localhost:9000"
        s3.access-key-id: "minioadmin"
        s3.secret-access-key: "minioadmin"
        s3.path-style-access: "true"

  # Spark Streaming Configuration
  streaming:
    checkpointLocation: "s3://sentiment-data/checkpoints"
    backpressure.enabled: "true"
    backpressure.initialRate: "1000"
    stopGracefullyOnShutdown: "true"

  # Spark Performance Configuration
  executor:
    memory: "4g"
    cores: "2"
    instances: "2"

  driver:
    memory: "2g"

  # Shuffle Configuration
  shuffle:
    partitions: "200"
    service.enabled: "true"

  # Network Configuration
  network:
    timeout: "300s"

  # Serializer
  serializer: "org.apache.spark.serializer.KryoSerializer"

  # Dynamic Allocation
  dynamicAllocation:
    enabled: "false"

# Job-specific configurations
jobs:
  preprocess:
    trigger: "10 seconds"
    watermark: "2 minutes"
    outputMode: "append"

  sentiment:
    trigger: "30 seconds"
    watermark: "5 minutes"
    outputMode: "append"
    checkpointLocation: "s3://sentiment-data/checkpoints/sentiment"

  enrichment:
    trigger: "1 minute"
    watermark: "10 minutes"
    outputMode: "update"
    checkpointLocation: "s3://sentiment-data/checkpoints/enrichment"

  aggregation:
    trigger: "1 minute"
    watermark: "15 minutes"
    outputMode: "complete"
    checkpointLocation: "s3://sentiment-data/checkpoints/aggregation"